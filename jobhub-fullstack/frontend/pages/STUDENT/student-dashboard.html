<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Sinh Vi√™n - JobHub</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .dashboard-container {
            min-height: 100vh;
            background: #f8f9fa;
            padding-top: 80px;
        }
        .welcome-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 16px;
            padding: 2rem;
        }
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid var(--primary-color);
        }
        .loading-spinner {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="sticky-top bg-white shadow-sm">
        <nav class="navbar navbar-expand-lg navbar-light">
            <div class="container">
                <a class="navbar-brand d-flex align-items-center" href="../index.html">
                    <div class="logo-icon me-2">
                        <i class="bi bi-briefcase"></i>
                    </div>
                    <span class="fw-bold">JobHub</span>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto me-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="student-dashboard.html">Dashboard</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="student-profile.html">H·ªì s∆°</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="job-search.html">T√¨m vi·ªác</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="my-applications.html">·ª®ng tuy·ªÉn</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../blog.html">Blog</a>
                        </li>
                    </ul>
                    <div class="d-flex gap-2 align-items-center">
                        <a href="../shared/notifications.html" class="btn btn-outline-secondary btn-sm position-relative">
                            <i class="bi bi-bell"></i>
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">0</span>
                        </a>
                        <div class="dropdown">
                            <button class="btn btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                <i class="bi bi-person-circle me-1"></i><span id="userName">ƒêang t·∫£i...</span>
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="student-profile.html">H·ªì s∆°</a></li>
                                <li><a class="dropdown-item" href="../shared/settings.html">C√†i ƒë·∫∑t</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-danger" onclick="handleLogout()">ƒêƒÉng xu·∫•t</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <!-- Loading Spinner -->
    <div class="text-center loading-spinner" id="loadingSpinner">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">ƒêang t·∫£i...</span>
        </div>
        <p class="mt-2">ƒêang t·∫£i dashboard...</p>
    </div>

    <!-- Main Content -->
    <div class="dashboard-container" id="dashboardContent" style="display: none;">
        <div class="container">
            <!-- Welcome Section -->
            <div class="welcome-card mb-4">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1 class="fw-bold mb-2" id="welcomeMessage">Ch√†o m·ª´ng tr·ªü l·∫°i! üéì</h1>
                        <p class="mb-0" id="welcomeSubtitle">S·∫µn s√†ng kh√°m ph√° c∆° h·ªôi vi·ªác l√†m m·ªõi?</p>
                    </div>
                    <div class="col-md-4 text-end">
                        <div class="badge bg-light text-primary fs-6">Sinh vi√™n</div>
                        <div class="mt-2">
                            <small id="profileCompletion">H·ªì s∆° ch∆∞a ho√†n thi·ªán</small>
                            <div class="progress mt-1" style="height: 6px;">
                                <div class="progress-bar" id="profileProgress" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats -->
            <div class="row g-4 mb-4">
                <div class="col-md-3">
                    <div class="stat-card">
                        <h3 class="fw-bold text-primary" id="applicationsCount">0</h3>
                        <p class="text-muted mb-0">ƒê√£ ·ª©ng tuy·ªÉn</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <h3 class="fw-bold text-success" id="interviewsCount">0</h3>
                        <p class="text-muted mb-0">ƒêang ph·ªèng v·∫•n</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <h3 class="fw-bold text-warning" id="savedJobsCount">0</h3>
                        <p class="text-muted mb-0">Vi·ªác l√†m ƒë√£ l∆∞u</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <h3 class="fw-bold text-info" id="cvCount">0</h3>
                        <p class="text-muted mb-0">CV ƒë√£ t·∫°o</p>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="row g-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">H√†nh ƒë·ªông nhanh</h5>
                            <div class="d-grid gap-2">
                                <a href="job-search.html" class="btn btn-primary">
                                    <i class="bi bi-search me-2"></i>T√¨m vi·ªác ngay
                                </a>
                                <a href="cv-builder.html" class="btn btn-outline-primary">
                                    <i class="bi bi-file-earmark-plus me-2"></i>T·∫°o CV m·ªõi
                                </a>
                                <a href="student-profile.html" class="btn btn-outline-primary">
                                    <i class="bi bi-person-gear me-2"></i>C·∫≠p nh·∫≠t h·ªì s∆°
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Vi·ªác l√†m g·ª£i √Ω</h5>
                            <p class="text-muted">D·ª±a tr√™n h·ªì s∆° c·ªßa b·∫°n</p>
                            <div id="suggestedJobs">
                                <div class="text-center text-muted py-3">
                                    <i class="bi bi-info-circle me-2"></i>
                                    Ho√†n thi·ªán h·ªì s∆° ƒë·ªÉ nh·∫≠n g·ª£i √Ω vi·ªác l√†m ph√π h·ª£p
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y</h5>
                            <div id="recentActivity">
                                <div class="text-center text-muted py-4">
                                    <i class="bi bi-clock-history display-4"></i>
                                    <p class="mt-2">Ch∆∞a c√≥ ho·∫°t ƒë·ªông n√†o</p>
                                    <a href="job-search.html" class="btn btn-primary btn-sm">B·∫Øt ƒë·∫ßu t√¨m vi·ªác</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container text-center">
            <p class="mb-0">&copy; 2025 JobHub. T·∫•t c·∫£ quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
        </div>
    </footer>

    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/auth.js"></script>
    
    <script>
        // Kh·ªüi t·∫°o dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Ki·ªÉm tra ƒëƒÉng nh·∫≠p
            if (!AUTH.requireAuth()) return;

            // Hi·ªÉn th·ªã th√¥ng tin user
            const user = AUTH.getUser();
            if (user) {
                document.getElementById('userName').textContent = user.fullName;
                document.getElementById('welcomeMessage').textContent = `Ch√†o m·ª´ng tr·ªü l·∫°i, ${user.fullName}! üéì`;
            }

            // T·∫£i d·ªØ li·ªáu dashboard
            loadDashboardData();
        });

        // T·∫£i d·ªØ li·ªáu dashboard
        async function loadDashboardData() {
            showLoading();
            
            try {
                // L·∫•y d·ªØ li·ªáu t·ª´ localStorage
                const userData = AUTH.getUser();
                const applications = JSON.parse(localStorage.getItem(`jobhub_applications_${userData.id}`) || '[]');
                const savedJobs = JSON.parse(localStorage.getItem(`jobhub_saved_jobs_${userData.id}`) || '[]');
                const userProfile = JSON.parse(localStorage.getItem(`jobhub_student_profile_${userData.id}`) || '{}');

                // C·∫≠p nh·∫≠t th·ªëng k√™
                document.getElementById('applicationsCount').textContent = applications.length;
                document.getElementById('savedJobsCount').textContent = savedJobs.length;
                
                // ƒê·∫øm s·ªë l∆∞·ª£ng ƒëang ph·ªèng v·∫•n
                const interviewingCount = applications.filter(app => 
                    app.status === 'reviewing' || app.status === 'interviewing'
                ).length;
                document.getElementById('interviewsCount').textContent = interviewingCount;

                // Ki·ªÉm tra CV
                const hasCV = !!userProfile.resumeUrl;
                document.getElementById('cvCount').textContent = hasCV ? '1' : '0';

                // T√≠nh % ho√†n thi·ªán h·ªì s∆°
                const profileCompletion = calculateProfileCompletion(userProfile);
                document.getElementById('profileProgress').style.width = `${profileCompletion}%`;
                document.getElementById('profileCompletion').textContent = 
                    profileCompletion === 100 ? 'H·ªì s∆° ƒë√£ ho√†n thi·ªán ‚úì' : `H·ªì s∆° ho√†n thi·ªán ${profileCompletion}%`;

                // Hi·ªÉn th·ªã n·ªôi dung
                hideLoading();

            } catch (error) {
                console.error('L·ªói t·∫£i dashboard:', error);
                hideLoading();
                alert('C√≥ l·ªói x·∫£y ra khi t·∫£i d·ªØ li·ªáu dashboard');
            }
        }

        // T√≠nh % ho√†n thi·ªán h·ªì s∆°
        function calculateProfileCompletion(profile) {
            const fields = [
                profile.university,
                profile.major, 
                profile.graduationYear,
                profile.skills,
                profile.bio
            ];
            
            const completedFields = fields.filter(field => field && field.trim() !== '').length;
            return Math.round((completedFields / fields.length) * 100);
        }

        // Hi·ªÉn th·ªã loading
        function showLoading() {
            document.getElementById('loadingSpinner').style.display = 'block';
            document.getElementById('dashboardContent').style.display = 'none';
        }

        // ·∫®n loading
        function hideLoading() {
            document.getElementById('loadingSpinner').style.display = 'none';
            document.getElementById('dashboardContent').style.display = 'block';
        }
    </script>
</body>
</html>